# InsightSummary: 투자 인사이트 요약

> 📄 **상위 문서**: [ETF_DETAIL.md](./ETF_DETAIL.md) § 3-2

가격·매매동향 데이터를 **프론트엔드 룰 기반**으로 분석하여 자동 생성되는 인사이트. 핵심 포인트(최대 4개)와 리스크 요약(최대 3개)을 카드 형태로 표시하며, API 호출 없이 클라이언트에서만 생성한다.

---

## 1. 동작 방식 개요

- **입력**: `pricesData`(가격 배열, 최신순), `tradingFlowData`(매매동향 배열, 최신순)
- **생성**: `utils/insights.js`의 `generateAllInsights(pricesData, tradingFlowData)` 호출
- **출력**: `{ insights: [], risks: [] }` — 각각 최대 4개·3개로 제한
- **표시 조건**: 인사이트·리스크가 모두 없으면 **null 반환(컴포넌트 미렌더)**

### 인사이트 타입 및 스타일

| type | 색상 | 아이콘 |
|------|------|--------|
| positive | 녹색 (text-green-700 / dark:text-green-400) | dot: bg-green-500 |
| warning | 주황 (text-orange-700 / dark:text-orange-400) | dot: bg-orange-500 |
| neutral | 회색 (text-gray-600 / dark:text-gray-400) | dot: bg-gray-400 |

---

## 2. 인사이트 생성 룰 (generateAllInsights)

### 2-1. 핵심 포인트 (generatePriceInsights + generateTradingInsights)

**매매동향 기반** (`generateTradingInsights`):

| 조건 | type | 예시 텍스트 |
|------|------|-------------|
| 외국인 순매수 3일 이상 연속 | positive | "외국인 순매수 N일 연속 지속 중" |
| 외국인 순매도 3일 이상 연속 | warning | "외국인 순매도 N일 연속 지속 중" |
| 기관 순매수 3일 이상 연속 | positive | "기관 순매수 N일 연속 지속 중" |
| 기관 순매도 3일 이상 연속 | warning | "기관 순매도 N일 연속 지속 중" |
| 최근 3일 외국인+기관 합산 순매수 10억↑ | positive | "최근 3일 외국인+기관 순매수 약 N억원" |
| 최근 3일 외국인+기관 합산 순매도 10억↑ | warning | 동일 패턴 |

**가격 기반** (`generatePriceInsights`):

| 조건 | type | 예시 |
|------|------|------|
| 5일선 > 20일선, 현재가 > 5일선 | positive | "단기 상승 추세 (5일선 > 20일선)" |
| 5일선 < 20일선, 현재가 < 5일선 | warning | "단기 하락 추세 (5일선 < 20일선)" |
| 최근 5일 내 골든크로스 | positive | "최근 골든크로스 발생 (단기 상승 신호)" |
| 최근 5일 내 데드크로스 | warning | "최근 데드크로스 발생 (단기 하락 신호)" |
| 일간 변동성 > 3% | warning | "변동성 확대 구간 (일간 N%)" |
| 일간 변동성 < 1% | neutral | "낮은 변동성 유지 (일간 N%)" |
| 20일 최고가 근접 (5% 이내) | positive | "20일 최고가 근접 구간" |
| 20일 최저가 근접 (5% 이내) | warning | "20일 최저가 근접 구간" |
| 4일 이상 연속 상승 | positive | "N일 연속 상승 중" |
| 4일 이상 연속 하락 | warning | "N일 연속 하락 중" |
| RSI 과매수/과매도 (30건↑) | (generateRSIInsight) | RSI 인사이트 |
| MACD 크로스 (40건↑) | (generateMACDInsight) | MACD 인사이트 |

**정렬·제한**: `priority` 오름차순 정렬 후 **상위 4개**만 사용.

### 2-2. 리스크 요약 (generateRiskInsights)

| 조건 | 예시 텍스트 |
|------|-------------|
| 일간 변동성 > 4% | "높은 변동성 주의 (일간 N%)" |
| 외국인+기관 동반 순매도 3일 연속 | "외국인+기관 동반 순매도 3일 연속" |
| 최근 5일 내 -5% 이상 급락일 존재 | "최근 급락일 발생 (단기 변동성 주의)" |

**제한**: **최대 3개**.

---

## 3. 데이터 요구사항

| 데이터 | 최소 | 용도 |
|--------|------|------|
| pricesData | 5건 | 가격·추세·변동성 |
| pricesData | 20건 | 20일 고/저 근접 |
| pricesData | 25건 | 골든/데드크로스 |
| pricesData | 30건 | RSI 인사이트 |
| pricesData | 40건 | MACD 인사이트 |
| tradingFlowData | 1건 | 외국인/기관 연속일 |
| tradingFlowData | 3건 | 3일 합산, 동반 매도 |

---

## 4. 문제 해결

| 현상 | 원인 | 조치 |
|------|------|------|
| 인사이트가 표시되지 않음 | 데이터 부족 또는 룰 미충족 | 5일 이상 가격 데이터 확인 |
| 리스크만 표시됨 | insights가 빈 배열, risks만 존재 | generateTradingInsights 결과 확인 |
| 컴포넌트가 아예 안 보임 | insights·risks 모두 빈 배열 | `return null` 조건 충족 — 정상 동작 |
| RSI/MACD 인사이트 없음 | pricesData 30/40건 미만 | 날짜 범위 1개월 이상으로 확대 |

---

## 5. 요약

| 항목 | 내용 |
|------|------|
| 컴포넌트 | `components/etf/InsightSummary.jsx` |
| 유틸 | `utils/insights.js` (generateAllInsights, generatePriceInsights, generateTradingInsights, generateRiskInsights) |
| 입력 | pricesData, tradingFlowData |
| 최대 | 핵심 포인트 4개, 리스크 3개 |
| API | 없음 (클라이언트 룰 기반) |

---

## 6. 관련 파일

| 파일 | 역할 |
|------|------|
| `frontend/src/components/etf/InsightSummary.jsx` | 인사이트 요약 UI |
| `frontend/src/utils/insights.js` | 인사이트 생성 룰 |
| `frontend/src/utils/technicalIndicators.js` | RSI, MACD 계산 (generateRSIInsight, generateMACDInsight 호출) |
