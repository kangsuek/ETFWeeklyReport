# IntradayChart: ë¶„ë´‰ ì°¨íŠ¸

> ğŸ“„ **ìƒìœ„ ë¬¸ì„œ**: [ETF_DETAIL.md](./ETF_DETAIL.md) Â§ 3-7

ë‹¹ì¼ **ì‹œê°„ë³„ ì²´ê²° ë°ì´í„°**ë¥¼ ì‹œê°í™”í•˜ëŠ” ë¶„ë´‰ ì°¨íŠ¸. ì¥ì¤‘/ì¥ì™¸ì— ë”°ë¼ ìë™ ê°±ì‹ Â·staleTimeì´ ë‹¤ë¥´ë©°, ì „ì¼ ì¢…ê°€Â·í”¼ë´‡ ë ˆë²¨Â·ëª©í‘œê°€ ìˆ˜í‰ì„ ì„ í‘œì‹œí•œë‹¤.

---

## 1. ì¡°íšŒ ë°©ì‹ ê°œìš”

- **API**: `GET /api/etfs/{ticker}/intraday`
- **íŒŒë¼ë¯¸í„°**: `target_date`(ì„ íƒ), `auto_collect`(ê¸°ë³¸ true), `force_refresh`(ìºì‹œ ë¬´ì‹œ)
- **enabled**: `!!ticker && !!etf` â€” ì¢…ëª© ê¸°ë³¸ ì •ë³´ ë¡œë“œ í›„ì—ë§Œ ìš”ì²­

### í”„ë¡ íŠ¸ì—”ë“œ (ETFDetail.jsx)

| ì¡°ê±´ | refetchInterval | staleTime |
|------|-----------------|-----------|
| ì¥ì¤‘ (09:00~15:30, í‰ì¼) | 20ì´ˆ | 10ì´ˆ |
| ìˆ˜ì§‘ ì¤‘ (background_collect_started) | 3ì´ˆ | â€” |
| ì¥ì™¸ | false (ë”) | 30ì´ˆ |

- `refetchOnMount: true`
- **ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨**: `forceRefreshRef.current = true` í›„ refetchIntraday() â†’ `force_refresh=true` ì „ì†¡

---

## 2. í‘œì‹œ ìš”ì†Œ

| ìš”ì†Œ | ì†ŒìŠ¤ | ì¡°ê±´ |
|------|------|------|
| ì „ì¼ ì¢…ê°€ ìˆ˜í‰ì„  | previousClose (pricesData[1]?.close_price) | previousClose ìˆì„ ë•Œ |
| í”¼ë´‡ ë ˆë²¨ | supportResistanceData?.pivot | showAdvanced(ê³ ê¸‰ë¶„ì„) ì‹œ |
| ëª©í‘œê°€ ìˆ˜í‰ì„  | alertRules (PriceTargetPanelê³¼ ë™ì¼) | buy/sell íƒ€ì…, is_active |
| ì°¨íŠ¸ ë°ì´í„° | intradayData.data | ì‹œê°€Â·ê³ ê°€Â·ì €ê°€Â·ì¢…ê°€Â·ê±°ë˜ëŸ‰Â·ì‹œê°„ |

---

## 3. IntradayChart ì»´í¬ë„ŒíŠ¸ Props

| Prop | íƒ€ì… | ìš©ë„ |
|------|------|------|
| data | array | ë¶„ë´‰ ë°°ì—´ [{ time, open, high, low, close, volume, price }] |
| ticker | string | ì¢…ëª© ì½”ë“œ |
| height | number | ì°¨íŠ¸ ë†’ì´ (ê¸°ë³¸ 300) |
| showVolume | boolean | ê±°ë˜ëŸ‰ í‘œì‹œ ì—¬ë¶€ |
| previousClose | number | ì „ì¼ ì¢…ê°€ ìˆ˜í‰ì„  |
| pivotLevels | object | í”¼ë´‡ R1~R3, P, S1~S3 |
| priceTargets | array | ì•Œë¦¼ ê·œì¹™ (ëª©í‘œê°€) |

---

## 4. ìƒíƒœë³„ UI (ETFDetail ì¹´ë“œ ë‚´)

| ìƒíƒœ | UI |
|------|-----|
| intradayLoading | 300px Spinner |
| intradayError | "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" + ì¬ì‹œë„ ë²„íŠ¼ |
| background_collect_started | Spinner + "ìˆ˜ì§‘ ì¤‘" + "ì ì‹œ í›„ ìë™ ê°±ì‹ " |
| count === 0 (ë¹„ì¥ì¤‘) | "ì¥ì¤‘ì´ ì•„ë‹ˆê±°ë‚˜ íœ´ì¥ì¼ì…ë‹ˆë‹¤. ì¥ ì‹œì‘ í›„ ë°ì´í„°ê°€ ìˆ˜ì§‘ë©ë‹ˆë‹¤." |

---

## 5. ì¥ì¤‘ ì—¬ë¶€ íŒë‹¨

```javascript
// 09:00 = 540ë¶„, 15:30 = 930ë¶„
const isMarketHours = (ë‚ ì§œ 1~5) && (ì‹œê°„ 540~930ë¶„)
// 1ë¶„ë§ˆë‹¤ setIntervalë¡œ ì¬í™•ì¸
```

---

## 6. ë°±ì—”ë“œ ì¡°íšŒÂ·ìˆ˜ì§‘ íë¦„ (ìš”ì•½)

1. ìºì‹œ í™•ì¸ (ì¥ì¤‘ 15ì´ˆ / ì¥ì™¸ 30ì´ˆ TTL). force_refresh ì‹œ ìºì‹œ ë¬´íš¨í™”
2. DB ì¡°íšŒ (09:00~15:30 ë²”ìœ„)
3. ë°ì´í„° ì—†ìœ¼ë©´ ë§ˆì§€ë§‰ ê±°ë˜ì¼ ì¬ì¡°íšŒ
4. ì¥ì¤‘ ì¬ìˆ˜ì§‘: ë§ˆì§€ë§‰ ì²´ê²° 3ë¶„ ê²½ê³¼ ì‹œ ì¬ìˆ˜ì§‘ íŠ¸ë¦¬ê±°
5. auto_collect=trueì´ê³  ë°ì´í„° ì—†ê±°ë‚˜ ì¬ìˆ˜ì§‘ í•„ìš” ì‹œ â†’ ë°±ê·¸ë¼ìš´ë“œ ìˆ˜ì§‘ (ì „ì²´ 40í˜ì´ì§€ ë˜ëŠ” ì¦ë¶„ ìµœëŒ€ 10í˜ì´ì§€)
6. ë¹ˆ ê²°ê³¼ëŠ” **ìºì‹œí•˜ì§€ ì•ŠìŒ** (ë‹¤ìŒ ìš”ì²­ì—ì„œ ìë™ ìˆ˜ì§‘ ì¬ì‹œë„)


---

## 7. ë¬¸ì œ í•´ê²°

| í˜„ìƒ | ì›ì¸ | ì¡°ì¹˜ |
|------|------|------|
| ì¥ì¤‘ ìë™ ê°±ì‹  ì•ˆ ë¨ | isMarketHours ì˜¤ë¥˜ ë˜ëŠ” refetchInterval ë¯¸ì ìš© | 1ë¶„ë§ˆë‹¤ ì¬í™•ì¸ ë¡œì§, useQuery ì˜µì…˜ í™•ì¸ |
| ë¶„ë´‰ ìˆ˜ì§‘ ì•ˆ ë¨ | ë¹ˆ ê²°ê³¼ ìºì‹œ | ë°±ì—”ë“œì—ì„œ ë¹ˆ ê²°ê³¼ ë¯¸ìºì‹œ (ì´ë¯¸ ì ìš©) |
| ìˆ˜ì§‘ ì¤‘ë‹¨ | íƒ€ì„ì•„ì›ƒ | intraday API íƒ€ì„ì•„ì›ƒ í™•ëŒ€ (LONG_API_TIMEOUT) |
| ì¥ ì‹œì‘ ë°ì´í„° ëˆ„ë½ | í˜ì´ì§€ ìˆ˜ ë¶€ì¡± | ë°±ì—”ë“œ 40í˜ì´ì§€+Î± ìë™ ìˆ˜ì§‘ |
| ëª©í‘œê°€ ì„  ì•ˆ ë³´ì„ | alertRules ë¯¸ì „ë‹¬ | useQuery ['alertRules', ticker] ê²°ê³¼ ì „ë‹¬ í™•ì¸ |

---

## 8. ìš”ì•½

| í•­ëª© | ì¥ì¤‘ (09:00~15:30, í‰ì¼) | ì¥ì™¸ |
|------|-------------------------|------|
| ìë™ ê°±ì‹  | 20ì´ˆ | ë” |
| staleTime | 10ì´ˆ | 30ì´ˆ |
| ìˆ˜ì§‘ ì¤‘ í´ë§ | 3ì´ˆ | 3ì´ˆ |
| ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ | force_refresh=true | ë™ì¼ |
| ì»´í¬ë„ŒíŠ¸ | IntradayChart | â€” |

---

## 9. ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì—­í•  |
|------|------|
| `frontend/src/components/charts/IntradayChart.jsx` | ë¶„ë´‰ ì°¨íŠ¸ UI |
| `frontend/src/pages/ETFDetail.jsx` | useQuery, forceRefresh, previousClose, pivotLevels, priceTargets |
| ì¡°íšŒÂ·ìˆ˜ì§‘Â·ìºì‹œ ìƒì„¸ |
| `backend` | intraday API, intraday_collector |
